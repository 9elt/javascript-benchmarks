#!/bin/bash

cpu_name() {
    option "$(lscpu | grep -i name | sed 's/Model name://g' | sed 's/  //g')"
}

cpu_threads() {
    option "$(cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_max_freq | wc -l)"
}

cpu_speed() {
    S="$(cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_max_freq | awk 'NR == 1')"
    option "$((S / 1000))"
}

parse_metadata() {
    METADATA=(
        "node_version" "$(node --version || option)"
        "cpu" "$(cpu_name), $(cpu_speed) MHz ($(cpu_threads))"
    )

    to_json "${METADATA[@]}"
}
