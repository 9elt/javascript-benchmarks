#!/bin/bash

escape_backticks() {
    echo -e "${@}" | sed "s/\`/\\\\\`/g"
}

sanitize() {
    echo "$( escape_backticks "${@}" )" | sed 's/\$/\\$/g'
}

# Generate the javascript benchmark code
#
# $1 => javascript snippet code
# $2 => available code
# $3 => javascript tests
#
# $4 => normal distribution samples
# $5 => snippet iterations
#
# $6 => benchmark version: simple, realistic, edge-case
# $7 => benchmark name
# $8 => file path
benchmark() {
    echo "
import('./src/js/utils.mjs').then(({
    _outliers,
    _snd
}) => {

    $2

    const _results = [];

    const _tests = () => {

        $1

        $3

    }

    _tests()

    for (let _i = 0; _i < $4 ; _i++) {

        const _start = performance.now();

        for (let _iter = 0; _iter < $5; _iter++) {

            $1

        }

        const _end = performance.now();

        _results.push(_end - _start);
    }

    const _result = {
        version: '$6',
        name: '$7',
        file_path: '/$8',
        code: \`$( sanitize "$1" )\`,
        result: _snd(_results),
    }

    console.clear();
    console.log(JSON.stringify(_result));
})"
}
